<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="/dashboard.css">
    <link rel="stylesheet" th:href="@{/css/dashboard.css}"/>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" rel="stylesheet"/>
    <link href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css" rel="stylesheet"/>
  	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
    <script src='https://unpkg.com/boxicons@2.1.4/dist/boxicons.js'></script>
  <style>
    .fade-in { animation: fadeIn 0.5s ease-out forwards; }
    .fade-out { animation: fadeOut 3s ease-in forwards; animation-delay: 2s; }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeOut {
        0% { opacity: 1; transform: translateY(0); }
        100% { opacity: 0; transform: translateY(-20px); }
    }
  </style>
</head>
<body class="inicio">
<div th:if="${success}" class="fixed top-5 left-1/2 transform  bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded shadow-lg z-50 fade-in fade-out" role="alert" id="successToast">
    <strong class="font-bold">¡Éxito! </strong>
    <span th:text="${success}"></span>
</div>
<div th:if="${error}" class="fixed top-5 left-1/2 transform  bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded shadow-lg z-50 fade-in fade-out" role="alert" id="errorToast">
    <strong class="font-bold">¡Error! </strong>
    <span th:text="${error}"></span>
</div>


<div class="bg-gray-100 dark:bg-gray-900 dark:text-white text-gray-600 h-screen flex overflow-hidden text-sm">
  <div class="bg-white dark:bg-gray-900 dark:border-gray-800 w-20 flex-shrink-0 border-r border-gray-200 flex-col hidden sm:flex">
    <div class="h-16 text-blue-500 flex items-center justify-center">
      <img src="https://cdn-icons-png.flaticon.com/128/3153/3153381.png" class="w-12" alt="profile" />
    </div>
    <!-- botones de navegacion -->
    <div class="flex mx-auto flex-grow mt-4 flex-col text-gray-400 space-y-4">
      <button class="h-10 w-12 dark:bg-gray-700 dark:text-white rounded-md flex items-center justify-center bg-blue-100 text-blue-500">
        <svg viewBox="0 0 24 24" class="h-5" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
          <polyline points="9 22 9 12 15 12 15 22"></polyline>
        </svg>
      </button>
      <button class="h-10 w-12 dark:text-gray-500 rounded-md flex items-center justify-center">
        <svg viewBox="0 0 24 24" class="h-5" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
          <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
        </svg>
      </button>
      <button class="h-10 w-12 dark:text-gray-500 rounded-md flex items-center justify-center">
        <svg viewBox="0 0 24 24" class="h-5" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
          <line x1="12" y1="11" x2="12" y2="17"></line>
          <line x1="9" y1="14" x2="15" y2="14"></line>
        </svg>
      </button>
      <button class="h-10 w-12 dark:text-gray-500 rounded-md flex items-center justify-center">
        <svg viewBox="0 0 24 24" class="h-5" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="3" width="7" height="7"></rect>
          <rect x="14" y="3" width="7" height="7"></rect>
          <rect x="14" y="14" width="7" height="7"></rect>
          <rect x="3" y="14" width="7" height="7"></rect>
        </svg>
      </button>
    </div>
  </div>
  <!-- barra de navegacion -->
  <div class="flex-grow overflow-hidden h-full flex flex-col">
    <div class="h-16 lg:flex w-full border-b border-gray-200 dark:border-gray-800 hidden px-10">
      <div class="flex h-full text-gray-600 dark:text-gray-400">
        <a href="#" class="cursor-pointer h-full border-b-2 border-blue-500 text-blue-500 dark:text-white dark:border-white inline-flex mr-8 items-center ">Usuarios</a>
        <a th:href="@{/admin/vendedores}" class="cursor-pointer h-full border-b-2 border-transparent inline-flex items-center mr-8">Vendedores</a>
        <a href="#" class="cursor-pointer h-full border-b-2 border-transparent inline-flex items-center mr-8"></a>
        <a href="#" class="cursor-pointer h-full border-b-2 border-transparent inline-flex items-center"></a>
      </div>
      <div class="ml-auto flex items-center space-x-7">
        <button class="flex items-center">
          <span class="relative flex-shrink-0">
            <img class="w-7 h-7 rounded-full" src="https://img.icons8.com/?size=80&id=UUr7TPbn4dvp&format=png" alt="profile" />
            <span class="absolute right-0 -mb-0.5 bottom-0 w-2 h-2 rounded-full bg-green-500 border border-white dark:border-gray-900"></span>
          </span>
          <span class="ml-2">Administrador</span>
          <svg viewBox="0 0 24 24" class="w-4 ml-1 flex-shrink-0" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </button>
        <button class="h-8 p-2 rounded-md shadow text-white bg-blue-500 hover:bg-blue-600 flex items-center justify-center">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
          </svg>
        </button>
      </div>
    </div>

    <div class="flex-grow flex overflow-x-hidden">
      <!--  <div class="xl:w-72 w-48 flex-shrink-0 border-r border-gray-200 dark:border-gray-800 h-full overflow-y-auto lg:block hidden p-5">
        <div class="text-xs text-gray-400 tracking-wider">USERS</div>
        <div class="relative mt-2">
          <input type="text" class="pl-8 h-9 bg-transparent border border-gray-300 dark:border-gray-700 dark:text-white w-full rounded-md text-sm" placeholder="Search" />
          <svg viewBox="0 0 24 24" class="w-4 absolute text-gray-400 top-1/2 transform translate-x-0.5 -translate-y-1/2 left-2" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
        </div>
        <div class="space-y-4 mt-3">
          <button class="bg-white p-3 w-full flex flex-col rounded-md dark:bg-gray-800 shadow">
            <div class="flex xl:flex-row flex-col items-center font-medium text-gray-900 dark:text-white pb-2 mb-2 xl:border-b border-gray-200 border-opacity-75 dark:border-gray-700 w-full">
              <img src="https://images.unsplash.com/photo-1438761681033-6461ffad8d80?ixlib=rb-0.3.5&q=80&fm=jpg&crop=faces&fit=crop&h=200&w=200&s=046c29138c1335ef8edee7daf521ba50" class="w-7 h-7 mr-2 rounded-full" alt="profile" />
              Kathyrn Murphy
            </div>
            <div class="flex items-center w-full">
              <div class="text-xs py-1 px-2 leading-none dark:bg-gray-900 bg-blue-100 text-blue-500 rounded-md">Design</div>
              <div class="ml-auto text-xs text-gray-500">$1,902.00</div>
            </div>
          </button>
          <button class="bg-white p-3 w-full flex flex-col rounded-md dark:bg-gray-800 shadow-lg relative ring-2 ring-blue-500 focus:outline-none">
            <div class="flex xl:flex-row flex-col items-center font-medium text-gray-900 dark:text-white pb-2 mb-2 xl:border-b border-gray-200 border-opacity-75 dark:border-gray-700 w-full">
              <img src="https://assets.codepen.io/344846/internal/avatars/users/default.png?fit=crop&format=auto&height=512&version=1582611188&width=512" class="w-7 h-7 mr-2 rounded-full" alt="profile" />
              Mert Cukuren
            </div>
            <div class="flex items-center w-full">
              <div class="text-xs py-1 px-2 leading-none dark:bg-gray-900 bg-green-100 text-green-600 rounded-md">Sales</div>
              <div class="ml-auto text-xs text-gray-500">$2,794.00</div>
            </div>
          </button>
          <button class="bg-white p-3 w-full flex flex-col rounded-md dark:bg-gray-800 shadow">
            <div class="flex xl:flex-row flex-col items-center font-medium text-gray-900 dark:text-white pb-2 mb-2 xl:border-b border-gray-200 border-opacity-75 dark:border-gray-700 w-full">
              <img src="https://images.unsplash.com/photo-1541647376583-8934aaf3448a?ixlib=rb-1.2.1&q=80&fm=jpg&crop=faces&fit=crop&h=200&w=200&ixid=eyJhcHBfaWQiOjE3Nzg0fQ" class="w-7 h-7 mr-2 rounded-full" alt="profile" />
              Albert Flores
            </div>
            <div class="flex items-center w-full">
              <div class="text-xs py-1 px-2 leading-none dark:bg-gray-900 bg-yellow-100 text-yellow-600 rounded-md">Marketing</div>
              <div class="ml-auto text-xs text-gray-400">$0.00</div>
            </div>
          </button>
          <button class="bg-white p-3 w-full flex flex-col rounded-md dark:bg-gray-800 shadow">
            <div class="flex xl:flex-row flex-col items-center font-medium text-gray-900 dark:text-white pb-2 mb-2 xl:border-b border-gray-200 border-opacity-75 dark:border-gray-700 w-full">
              <img src="https://images.unsplash.com/photo-1519699047748-de8e457a634e?ixlib=rb-1.2.1&q=80&fm=jpg&crop=faces&fit=crop&h=200&w=200&ixid=eyJhcHBfaWQiOjE3Nzg0fQ" class="w-7 h-7 mr-2 rounded-full" alt="profile" />
              Jane Cooper
            </div>
            <div class="flex items-center w-full">
              <div class="text-xs py-1 px-2 leading-none dark:bg-gray-900 bg-blue-100 text-blue-500 rounded-md">Design</div>
              <div class="ml-auto text-xs text-gray-500">$762.00</div>
            </div>
          </button>
          <button class="bg-white p-3 w-full flex flex-col rounded-md dark:bg-gray-800 shadow">
            <div class="flex xl:flex-row flex-col items-center font-medium text-gray-900 dark:text-white pb-2 mb-2 xl:border-b border-gray-200 border-opacity-75 dark:border-gray-700 w-full">
              <img src="https://images.unsplash.com/photo-1507120878965-54b2d3939100?ixlib=rb-0.3.5&q=80&fm=jpg&crop=faces&fit=crop&h=200&w=200&s=99fbace66d1bfa48c9c6dc8afcac3aab" class="w-7 h-7 mr-2 rounded-full" alt="profile" />
              Ronald Richards
            </div>
            <div class="flex items-center w-full">
              <div class="text-xs py-1 px-2 leading-none dark:bg-gray-900 bg-green-100 text-green-600 rounded-md">Sales</div>
              <div class="ml-auto text-xs text-gray-400">$0.00</div>
            </div>
          </button>
        </div>
      </div> -->
      <div class="flex-grow bg-white dark:bg-gray-900 overflow-y-auto">
        <div class="sm:px-7 sm:pt-7 px-4 pt-4 flex flex-col w-full border-b border-gray-200 bg-white dark:bg-gray-900 dark:text-white dark:border-gray-800 sticky top-0 z-10">
          <div class="flex w-full items-center">
            <div class="flex items-center text-3xl text-gray-900 dark:text-white">
              <img src="https://img.icons8.com/?size=48&id=11901&format=png" class="w-12 mr-4 rounded-full" alt="profile" />
              Administrar Usuarios
            </div>
            <div class="ml-auto sm:flex hidden items-center justify-end">
              <div class="text-right">
                <div class="text-xs text-gray-400 dark:text-gray-400">Total de usuarios:</div>
                <div id="totalUsuarios" class="text-gray-900 text-lg dark:text-white"></div>
              </div>
              <button class="w-8 h-8 ml-4 text-gray-400 shadow dark:text-gray-400 rounded-full flex items-center justify-center border border-gray-200 dark:border-gray-700">
                <svg viewBox="0 0 24 24" class="w-4" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="1"></circle>
                  <circle cx="19" cy="12" r="1"></circle>
                  <circle cx="5" cy="12" r="1"></circle>
                </svg>
              </button>
            </div>
          </div>
          <!-- <div class="flex items-center space-x-3 sm:mt-7 mt-4">
            <a href="#" class="px-3 border-b-2 border-blue-500 text-blue-500 dark:text-white dark:border-white pb-1.5">Activities</a>
            <a href="#" class="px-3 border-b-2 border-transparent text-gray-600 dark:text-gray-400 pb-1.5">Transfer</a>
            <a href="#" class="px-3 border-b-2 border-transparent text-gray-600 dark:text-gray-400 pb-1.5 sm:block hidden">Budgets</a>
            <a href="#" class="px-3 border-b-2 border-transparent text-gray-600 dark:text-gray-400 pb-1.5 sm:block hidden">Notifications</a>
            <a href="#" class="px-3 border-b-2 border-transparent text-gray-600 dark:text-gray-400 pb-1.5 sm:block hidden">Cards</a>
          </div> -->
        </div>

        <!-- filtros -->
        <div class="sm:p-7 p-4">
          <div class="flex w-full items-center mb-7 gap-4">
            <!-- Filtro de Visibilidad de Columnas -->
            <div class="relative inline-block">
              <button id="btnColumnas"
                      class="inline-flex items-center h-8 pl-2.5 pr-2 rounded-md shadow text-gray-200 bg-gray-700 border border-gray-600 hover:bg-gray-600 transition">
                <svg xmlns="http://www.w3.org/2000/svg"
                    class="w-5 h-5 mr-2 text-gray-300"
                    fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4 6h16M4 10h16M4 14h16M4 18h16"/>
                </svg>
                Columnas
                <svg viewBox="0 0 24 24"
                    class="w-4 ml-1.5 text-gray-400"
                    stroke="currentColor" stroke-width="2" fill="none"
                    stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </button>
              <div id="dropdownColumnas"
                  class="hidden absolute mt-1 bg-gray-800 text-gray-200 border border-gray-600 rounded shadow-lg z-50">
              </div>
            </div>

            <!-- Filtro por Rol -->
            <div class="relative inline-block">
              <button id="btnRol"
                      class="inline-flex items-center h-8 pl-2.5 pr-2 rounded-md shadow text-gray-200 bg-gray-700 border border-gray-600 hover:bg-gray-600 transition">
                <svg xmlns="http://www.w3.org/2000/svg"
                    class="w-5 h-5 mr-2 text-gray-300"
                    fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M5.121 17.804A13.937 13.937 0 0112 15c2.5 0 4.847.68 6.879 1.804M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
                Rol
                <svg viewBox="0 0 24 24"
                    class="w-4 ml-1.5 text-gray-400"
                    stroke="currentColor" stroke-width="2" fill="none"
                    stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </button>
              <div id="dropdownRol"
                  class="hidden absolute mt-1 bg-gray-800 text-gray-200 border border-gray-600 rounded shadow-lg z-50">
                <label class="flex items-center px-3 py-1 hover:bg-gray-700">
                  <input type="radio" name="filterRol" value="" checked class="mr-2">
                  <i class="fas fa-list mr-2"></i> Todos
                </label>
                <label class="flex items-center px-3 py-1 hover:bg-gray-700">
                  <input type="radio" name="filterRol" value="admin" class="mr-2">
                  <i class="fas fa-user-shield mr-2"></i> Admin
                </label>
                <label class="flex items-center px-3 py-1 hover:bg-gray-700">
                  <input type="radio" name="filterRol" value="cliente" class="mr-2">
                  <i class="fas fa-user mr-2"></i> Cliente
                </label>
              </div>
            </div>

            <!-- Filtro por Estado -->
            <div class="relative inline-block">
              <button id="btnEstado"
                      class="inline-flex items-center h-8 pl-2.5 pr-2 rounded-md shadow text-gray-200 bg-gray-700 border border-gray-600 hover:bg-gray-600 transition">
                <svg xmlns="http://www.w3.org/2000/svg"
                    class="w-5 h-5 mr-2 text-gray-300"
                    fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M9 12l2 2 4-4m1 8a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                Estado
                <svg viewBox="0 0 24 24"
                    class="w-4 ml-1.5 text-gray-400"
                    stroke="currentColor" stroke-width="2" fill="none"
                    stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </button>
              <div id="dropdownEstado"
                  class="hidden absolute mt-1 bg-gray-800 text-gray-200 border border-gray-600 rounded shadow-lg z-50">
                <label class="flex items-center px-3 py-1 hover:bg-gray-700">
                  <input type="radio" name="filterEstado" value="" checked class="mr-2">
                  <i class="fas fa-list mr-2"></i> Todos
                </label>
                <label class="flex items-center px-3 py-1 hover:bg-gray-700">
                  <input type="radio" name="filterEstado" value="activo" class="mr-2">
                  <i class="fas fa-check-circle mr-2"></i> Activo
                </label>
                <label class="flex items-center px-3 py-1 hover:bg-gray-700">
                  <input type="radio" name="filterEstado" value="inactivo" class="mr-2">
                  <i class="fas fa-times-circle mr-2"></i> Inactivo
                </label>
                <label class="flex items-center px-3 py-1 hover:bg-gray-700">
                  <input type="radio" name="filterEstado" value="suspendido" class="mr-2">
                  <i class="fas fa-ban mr-2"></i> Suspendido
                </label>
              </div>
            </div>
            <button id="open-add-modal" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded">
              <i class="fas fa-user-plus"></i>
            </button>
            <div class="ml-auto text-gray-500 text-xs sm:inline-flex hidden items-center gap-4 mb-4">
              <button
                id="exportExcelBtn"
                class="flex items-center px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4 4h16v16H4V4zm4 4h8m-8 4h5m-5 4h3"/>
                </svg>
                Excel
              </button>
              <button
                id="exportPdfBtn"
                class="flex items-center px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 14l9-5-9-5-9 5 9 5zm0 0v5m0-5l9-5m-9 5L3 9m9 5V4"/>
                </svg>
                PDF
              </button>
            </div>
          </div>
          <div class="container-table">
            <table class="w-full text-left" id="tablaUsuarios">
              <thead>
                <tr class="text-gray-400">
                  <th class="font-normal px-3 pt-0 pb-3 border-b border-gray-200 dark:border-gray-800"><Nav>N°</Nav></th>
                  <th class="font-normal px-3 pt-0 pb-3 border-b border-gray-200 dark:border-gray-800">Nombre</th>
                  <th class="font-normal px-3 pt-0 pb-3 border-b border-gray-200 dark:border-gray-800 hidden md:table-cell">Apellido</th>
                  <th class="font-normal px-3 pt-0 pb-3 border-b border-gray-200 dark:border-gray-800">Numero de teléfono</th>
                  <th class="font-normal px-3 pt-0 pb-3 border-b border-gray-200 dark:border-gray-800">Correo</th>
                  <th class="font-normal px-3 pt-0 pb-3 border-b border-gray-200 dark:border-gray-800">dni</th>
                  <th class="font-normal px-3 pt-0 pb-3 border-b border-gray-200 dark:border-gray-800 sm:text-gray-400 text-white">Rol</th>
                  <th class="font-normal px-3 pt-0 pb-3 border-b border-gray-200 dark:border-gray-800 sm:text-gray-400 text-white">Fecha creación</th>
                  <th class="font-normal px-3 pt-0 pb-3 border-b border-gray-200 dark:border-gray-800 sm:text-gray-400 text-white">Estado</th>
                  <th class="font-normal px-3 pt-0 pb-3 border-b border-gray-200 dark:border-gray-800 sm:text-gray-400 text-white">Acciones</th>
                </tr>
              </thead>
              <tbody class="text-gray-600 dark:text-gray-100">
                <tr th:each="usuario, iterStat : ${usuarios}" th:attr="data-id=${usuario.id}">
                  <td th:text="${iterStat.count}" class="sm:p-3 py-2 px-1 border-b border-gray-200 dark:border-gray-800"></td>
                  <td data-campo="nombre" th:text="${usuario.nombre}" class="sm:p-3 py-2 px-1 border-b border-gray-200 dark:border-gray-800"></td>
                  <td data-campo="apellido" th:text="${usuario.apellido}" class="sm:p-3 py-2 px-1 border-b border-gray-200 dark:border-gray-800"></td>
                  <td data-campo="telefono" th:text="${usuario.telefono}" class="sm:p-3 py-2 px-1 border-b border-gray-200 dark:border-gray-800"></td>
                  <td data-campo="correo" th:text="${usuario.correo}" class="sm:p-3 py-2 px-1 border-b border-gray-200 dark:border-gray-800 text-blue-500 correo-usuario"></td>
                  <td data-campo="dni" th:text="${usuario.dni}" class="sm:p-3 py-2 px-1 border-b border-gray-200 dark:border-gray-800"></td>
                  <td data-campo="rol" th:text="${usuario.rol}" class="sm:p-3 py-2 px-1 border-b border-gray-200 dark:border-gray-800"></td>
                  <td data-campo="fechaCreacion" th:text="${#temporals.format(usuario.fechaCreacion, 'dd/MM/yyyy HH:mm')}" class="sm:p-3 py-2 px-1 border-b border-gray-200 dark:border-gray-800"></td>
                  <td data-campo="estado" th:text="${usuario.estado}" class="sm:p-3 py-2 px-1 border-b border-gray-200 dark:border-gray-800"></td>
                  <td>
                      <button 
                        class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded edit-btn"
                        th:data-id="${usuario.id}"
                        th:data-nombre="${usuario.nombre}"
                        th:data-apellido="${usuario.apellido}"
                        th:data-telefono="${usuario.telefono}"
                        th:data-dni="${usuario.dni}"
                        th:data-correo="${usuario.correo}"
                        th:data-rol="${usuario.rol}"
                        th:data-estado="${usuario.estado}">
                        <i class="fas fa-edit"></i>
                      </button>
                      <button class="bg-purple-500 hover:bg-purple-600 text-white px-3 py-1 rounded btn-verdetalle-cliente">
                          <i class='bx bx-detail'></i>
                      </button>
                      <button type="button"
                              class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded btn-eliminar-cliente"
                              th:data-id="${usuario.id}"
                              th:data-nombre="${usuario.nombre}">
                          <i class="fas fa-trash-alt"></i>
                      </button>

                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!--Modal DE editar-->
          <div id="edit-modal" class="fixed inset-0 flex items-center justify-center hidden z-50">
            <div class="absolute inset-0 bg-black opacity-50"></div>
            <div class="bg-gray-800 text-gray-100 rounded-lg shadow-lg w-11/12 md:w-1/2 z-50 relative">
              <div class="px-6 py-4 border-b border-gray-700">
                <h2 class="text-xl font-semibold">Editar Usuario</h2>
              </div>
              <form id="edit-form" th:action="@{/admin/actualizar/__id__}" method="post" class="px-6 py-4">
                <div class="grid grid-cols-2 gap-4">
                  <div>
                    <label for="modal-nombre" class="block text-sm font-medium text-gray-300">Nombre</label>
                    <input type="text" name="nombre" id="modal-nombre" value="" class="mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-white" required>
                  </div>
                  <div>
                    <label for="modal-apellido" class="block text-sm font-medium text-gray-300">Apellido</label>
                    <input type="text" name="apellido" id="modal-apellido" value="" class="mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-white" required>
                  </div>
                  <div>
                    <label for="modal-telefono" class="block text-sm font-medium text-gray-300">Teléfono</label>
                    <input type="text" name="telefono" id="modal-telefono" value="" class="mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-white">
                  </div>
                  <div>
                    <label for="modal-dni" class="block text-sm font-medium text-gray-300">DNI</label>
                    <input type="text" name="dni" id="modal-dni" value="" class="mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-white">
                  </div>
                  <div class="col-span-2">
                    <label for="modal-correo" class="block text-sm font-medium text-gray-300">Correo</label>
                    <input type="email" name="correo" id="modal-correo" value="" class="mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-white" required>
                  </div>
                  <div>
                    <label for="modal-rol" class="block text-sm font-medium text-gray-300">Rol</label>
                    <select name="rol" id="modal-rol" class="mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-white">
                      <option value="cliente">Cliente</option>
                      <option value="admin">Admin</option>
                    </select>
                  </div>
                  <div>
                    <label for="modal-estado" class="block text-sm font-medium text-gray-300">Estado</label>
                    <select name="estado" id="modal-estado" class="mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-white">
                      <option value="activo">Activo</option>
                      <option value="inactivo">Inactivo</option>
                      <option value="suspendido">Suspendido</option>
                    </select>
                  </div>
                </div>
                <div class="mt-6 flex justify-end space-x-2">
                  <button type="button" id="cancel-btn" class="px-4 py-2 bg-gray-600 rounded hover:bg-gray-500">Cancelar</button>
                  <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">Guardar</button>
                </div>
              </form>
            </div>
          </div>

          <!-- Modal agregar usuario -->
          <div id="add-modal" class="fixed inset-0 flex items-center justify-center hidden z-50">
            <div class="absolute inset-0 bg-black opacity-50"></div>
            <div class="bg-gray-800 text-gray-100 rounded-lg shadow-lg w-11/12 md:w-1/2 z-50 relative">
              <div class="px-6 py-4 border-b border-gray-700">
                <h2 class="text-xl font-semibold">Agregar Usuario</h2>
              </div>
              <form id="add-form" th:action="@{/admin/crear}" method="post" class="px-6 py-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div class="flex flex-col gap-4">
                    <div>
                      <label for="add-nombre" class="block text-sm font-medium text-gray-300">Nombre</label>
                      <input type="text" name="nombre" id="add-nombre" class="mt-1 w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-white" required>
                    </div>
                    <div>
                      <label for="add-telefono" class="block text-sm font-medium text-gray-300">Teléfono</label>
                      <input type="text" name="telefono" id="add-telefono"
                            class="mt-1 w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-white"
                            placeholder="+51 955 444 333" maxlength="16" required>
                      <span id="telefono-error-add" class="text-red-400 text-sm hidden mt-1">Número inválido</span>
                    </div>
                    <div>
                      <label for="add-correo" class="block text-sm font-medium text-gray-300">Correo</label>
                      <input type="email" name="correo" id="add-correo" class="mt-1 w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-white" required>
                      <span id="correo-error-add" class="text-red-500 text-sm mt-1 hidden"></span>
                    </div>
                    <div>
                      <label for="add-rol" class="block text-sm font-medium text-gray-300">Rol</label>
                      <select name="rol" id="add-rol" class="mt-1 w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-white">
                      <option value="cliente">Cliente</option>
                        <option value="admin">Admin</option>
                      </select>
                    </div>
                  </div>
                  <div class="flex flex-col gap-4">
                    <div>
                      <label for="add-apellido" class="block text-sm font-medium text-gray-300">Apellido</label>
                      <input type="text" name="apellido" id="add-apellido" class="mt-1 w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-white" required>
                    </div>
                    <div>
                      <label for="add-dni" class="block text-sm font-medium text-gray-300">DNI</label>
                      <input type="text" name="dni" id="add-dni" class="mt-1 w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-white">
                    </div>
                    <div>
                      <label for="contrasena" class="block text-sm font-medium text-gray-300">Contraseña:</label>
                      <input type="password" id="contrasena" name="contraseñaHash" class="mt-1 w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-white" required>
                    </div>
                    <div>
                      <label for="add-estado" class="block text-sm font-medium text-gray-300">Estado</label>
                      <select name="estado" id="add-estado" class="mt-1 w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-white">
                        <option value="activo">Activo</option>
                        <option value="inactivo">Inactivo</option>
                        <option value="suspendido">Suspendido</option>
                      </select>
                    </div>
                  </div>
                </div>
                <div class="mt-6 flex justify-end space-x-2">
                  <button type="button" id="cancel-add-btn" class="px-4 py-2 bg-gray-600 rounded hover:bg-gray-500">Cancelar</button>
                  <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Guardar</button>
                </div>
              </form>
            </div>
          </div>
          
          <!-- Modal de Detalle -->
          <div id="detalle-modal" class="fixed inset-0 flex items-center justify-center hidden z-50">
            <div class="absolute inset-0 bg-black opacity-50"></div>
            <div class="bg-gray-800 text-white rounded-lg shadow-lg w-11/12 md:w-1/3 z-50 p-6">
              <h2 class="text-2xl font-semibold mb-4 text-center text-white">Detalles del Usuario</h2>
              <div class="space-y-3 text-gray-200">
                <p><strong>Nombre:</strong> <span id="detalle-nombre"></span></p>
                <p><strong>Apellido:</strong> <span id="detalle-apellido"></span></p>
                <p><strong>Correo:</strong> <span id="detalle-correo"></span></p>
                <p><strong>Teléfono:</strong> <span id="detalle-telefono"></span></p>
                <p><strong>DNI:</strong> <span id="detalle-dni"></span></p>
                <p><strong>Rol:</strong> <span id="detalle-rol"></span></p>
                <p><strong>Estado:</strong> <span id="detalle-estado"></span></p>
              </div>
              <div class="mt-6 text-right">
                <button id="cerrar-detalle-modal" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded">Cerrar</button>
              </div>
            </div>
          </div>

          <!-- Modal de Eliminar -->
          <div id="modalEliminar" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 hidden">
            <div class="bg-gray-800 text-white rounded-lg shadow-lg w-full max-w-md p-6">
              <h2 class="text-xl font-semibold mb-4">¿Eliminar Usuario?</h2>
              <p class="mb-6">¿Estás seguro de que deseas eliminar al usuario <span id="nombreUsuarioEliminar" class="font-bold"></span>?</p>
              <div class="flex justify-end space-x-4">
                <button id="cancelarEliminar" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 rounded">Cancelar</button>
                <form id="formEliminar" method="get">
                  <button type="submit" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded text-white">Eliminar</button>
                </form>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>

<script>
  $(document).ready(function () {
    let todosLosCorreosConocidos = [];

    window.table = $('#tablaUsuarios').DataTable({
      pageLength: 10,
      lengthMenu: [5, 10, 20, 50],
      dom: 'frtip',
      buttons: [
        {
          extend: 'excelHtml5',
          title: 'Lista de Usuarios',
          exportOptions: { columns: [0,1,2,3,4,5,6,7] }
        },
        {
          extend: 'pdfHtml5',
          title: 'Lista de Usuarios',
          orientation: 'landscape',
          pageSize: 'A4',
          exportOptions: { columns: [0,1,2,3,4,5,6,7] },
          customize: function (doc) {
            doc.defaultStyle = { fontSize: 8 };
            doc.styles.title   = { fontSize: 12, alignment: 'center' };
            doc.content[1].table.widths = [
              '3%','15%','15%','15%','15%','10%','10%','*'
            ];
            doc.content[1].layout = 'default';
            doc.content[1].table.body.forEach(function(row) {
              row.forEach(function(cell) {
                cell.alignment = 'center';
              });
            });
          }
        }
      ],
      language: {
        url: "//cdn.datatables.net/plug-ins/1.10.25/i18n/Spanish.json"
      },
      columnDefs: [
        { targets: [2], orderable: false, searchable: false },
        { targets: [9], orderable: false, searchable: false }
      ]
    });

    function actualizarListaCorreosDataTables() {
      if (window.table) {
        todosLosCorreosConocidos = window.table.column(4).data().toArray().map(correo => String(correo).toLowerCase().trim());
      }
    }


    $('#exportExcelBtn').on('click', function () {
      window.table.button(0).trigger();
    });
    $('#exportPdfBtn').on('click', function () {
      window.table.button(1).trigger();
    });

    // --------- FILTROS ---------
    const $dropdownCols = $('#dropdownColumnas');
    table.columns().every(function (idx) {
      if (idx === 9) return; 
      const title = $(this.header()).text().trim();
      const checked = this.visible() ? 'checked' : '';
      $dropdownCols.append(
        `<label class="flex items-center px-3 py-1">
           <input type="checkbox" class="col-toggle mr-2" data-col="${idx}" ${checked}>
           ${title}
         </label>`
      );
    });
    
    $('#btnColumnas').on('click', function (e) {
      e.stopPropagation();
      $dropdownCols.toggleClass('hidden');
      $('#dropdownRol, #dropdownEstado').addClass('hidden');
    });
    
    $(document).on('click', function () {
      $dropdownCols.addClass('hidden');
      $('#dropdownRol, #dropdownEstado').addClass('hidden');
    });
    
    $dropdownCols.on('change', '.col-toggle', function () {
      const colIdx = $(this).data('col');
      const visible = $(this).is(':checked');
      table.column(colIdx).visible(visible);
    });
    
    $dropdownCols.on('click', function (e) {
      e.stopPropagation();
    });

    // --------- FILTRO POR ROL ---------
    $('#btnRol').on('click', function (e) {
      e.stopPropagation();
      $('#dropdownRol').toggleClass('hidden');
      $('#dropdownColumnas, #dropdownEstado').addClass('hidden');
    });
    $('#dropdownRol input[name="filterRol"]').on('change', function () {
      const val = $(this).val();
      table.column(6)
           .search(val)
           .draw();
    });
    $('#dropdownRol').on('click', function (e) {
      e.stopPropagation();
    });

    // --------- FILTRO POR ESTADO ---------
    $('#btnEstado').on('click', function (e) {
      e.stopPropagation();
      $('#dropdownEstado').toggleClass('hidden');
      $('#dropdownColumnas, #dropdownRol').addClass('hidden');
    });

    $('#dropdownEstado input[name="filterEstado"]').on('change', function () {
      const val = $(this).val();
      if (!val) {
        table.column(8).search('').draw();
      } else {
        table
          .column(8) 
          .search(`^${val}$`, true /* regex */, false /* smart */)
          .draw();
      }
    });

    $('#dropdownEstado').on('click', function (e) {
      e.stopPropagation();
    });

    function actualizarTotalUsuarios() {
      const total = window.table.rows().count();
      $('#totalUsuarios').text(` ${total}`);
    }
    window.table.on('draw', function () {
      actualizarTotalUsuarios();
    });

    // --------- MODAL DETALLE ---------
    $('.btn-verdetalle-cliente').click(function () {
      var row = $(this).closest('tr');

      $('#detalle-nombre').text(row.find('td[data-campo="nombre"]').text());
      $('#detalle-apellido').text(row.find('td[data-campo="apellido"]').text());
      $('#detalle-correo').text(row.find('td[data-campo="correo"]').text());
      $('#detalle-telefono').text(row.find('td[data-campo="telefono"]').text());
      $('#detalle-dni').text(row.find('td[data-campo="dni"]').text());
      $('#detalle-rol').text(row.find('td[data-campo="rol"]').text());
      $('#detalle-estado').text(row.find('td[data-campo="estado"]').text());

      $('#detalle-modal').removeClass('hidden');
    });

    $('#cerrar-detalle-modal').click(function () {
      $('#detalle-modal').addClass('hidden');
    });

    // --------- MODAL AGREGAR USUARIO Y VALIDACIÓN DE CORREO ---------
    $('#open-add-modal').click(function () {
      $('#add-form')[0].reset();
      $('#add-correo').removeClass('border-red-500');
      $('#correo-error-add').addClass('hidden').text('');
      $('#add-modal').removeClass('hidden');
      actualizarListaCorreosDataTables();
    });

    $('#cancel-add-btn').click(function () {
      $('#add-modal').addClass('hidden');
      $('#add-form')[0].reset();
      $('#add-correo').removeClass('border-red-500');
      $('#correo-error-add').addClass('hidden').text('');
    });

    $('#add-correo').on('input keyup', function () {
      const correoIngresado = $(this).val().toLowerCase().trim();
      let correoDuplicado = false;

      if (correoIngresado.length > 0 && todosLosCorreosConocidos.includes(correoIngresado)) {
        correoDuplicado = true;
      }

      const $errorSpan = $('#correo-error-add');
      if (correoDuplicado) {
        $errorSpan.text('Este correo ya está registrado. Usa otro.').removeClass('hidden');
        $(this).addClass('border-red-500');
      } else {
        $errorSpan.addClass('hidden').text('');
        $(this).removeClass('border-red-500');
      }
    });

    $('#add-telefono').on('input', function () {
      let input = $(this).val().replace(/\D/g, '');
      if (input.startsWith('51')) {
        input = input.substring(2);
      }
      input = input.substring(0, 9); 
      const formatted = input.replace(/(\d{3})(\d{3})(\d{0,3})/, (_, p1, p2, p3) => {
        return `+51 ${p1} ${p2}${p3 ? ' ' + p3 : ''}`;
      });

      $(this).val(formatted);
    });

    $('#add-form').on('submit', function (e) {
      $('#add-correo').trigger('input');

      const $errorCorreo = $('#correo-error-add');
      if (!$errorCorreo.hasClass('hidden') && $errorCorreo.text() !== '') {
        e.preventDefault();
        $('#add-correo').focus();
        return;
      }

      const telefono = $('#add-telefono').val();
      const telefonoRegex = /^\+51 \d{3} \d{3} \d{3}$/;

      if (!telefonoRegex.test(telefono)) {
        $('#telefono-error-add').removeClass('hidden');
        e.preventDefault();
        $('#add-telefono').focus();
      } else {
        $('#telefono-error-add').addClass('hidden');
      }
    });


    window.table.on('init.dt', function() {
        actualizarTotalUsuarios();
        actualizarListaCorreosDataTables();
    });
    actualizarTotalUsuarios(); 
    actualizarListaCorreosDataTables();

  });
</script>
<script th:inline="javascript">
  /*<![CDATA[*/
  $(document).ready(function() {
    $('.edit-btn').click(function() {
      var id = $(this).data('id');
      $('#modal-nombre').val($(this).data('nombre'));
      $('#modal-apellido').val($(this).data('apellido'));
      $('#modal-telefono').val($(this).data('telefono'));
      $('#modal-dni').val($(this).data('dni'));
      $('#modal-correo').val($(this).data('correo'));
      $('#modal-rol').val($(this).data('rol'));
      $('#modal-estado').val($(this).data('estado'));

      $('#edit-form').attr('action', '/admin/actualizar/' + id);

      $('#edit-modal').removeClass('hidden'); 
    });

    $('#cancel-btn').click(function() {
      $('#edit-modal').addClass('hidden'); 
    });
  });
  /*]]>*/
</script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const modal = document.getElementById("modalEliminar");
    const nombreUsuarioSpan = document.getElementById("nombreUsuarioEliminar");
    const formEliminar = document.getElementById("formEliminar");
    const cancelarBtn = document.getElementById("cancelarEliminar");

    document.querySelectorAll(".btn-eliminar-cliente").forEach(btn => {
      btn.addEventListener("click", function () {
        const id = this.getAttribute("data-id");
        const nombre = this.getAttribute("data-nombre");

        nombreUsuarioSpan.textContent = nombre;
        formEliminar.setAttribute("action", `/admin/eliminar/${id}`);
        modal.classList.remove("hidden");
      });
    });

    cancelarBtn.addEventListener("click", function () {
      modal.classList.add("hidden");
    });
  });
</script>


<script src="https://cdn.tailwindcss.com"></script>

</body>
</html>
